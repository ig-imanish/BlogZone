<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Page</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link rel="stylesheet" th:href="@{/css/global.css}" />
    <!-- <link rel="stylesheet" href="/src/main/resources/static/css/global.css" /> -->
  </head>
  <body>
    <!-- Loading overlay -->
    <div th:if="${loading}" class="loading-overlay">
      <div class="loading-spinner"></div>
    </div>

    <div class="container" th:if="${user != null}">
      <div class="profile-section">
        <div class="header">
          <img
            th:if="${user.userBanner != null}"
            th:src="'data:image/jpeg;base64,' + ${user.userBannerBase64}"
            alt="Banner"
          />
          <img
            th:unless="${user.userBanner != null}"
            th:src="@{/img/banner.jpg}"
            alt="Banner"
          />
        </div>
        <div class="profile-image">
          <img
            th:if="${user.userAvatar != null}"
            th:src="'data:image/jpeg;base64,' + ${user.userAvatarBase64}"
            alt="Profile Image"
          />
          <img
            th:unless="${user.userAvatar != null}"
            th:src="@{/img/profile.jpg}"
            alt="Profile Image"
          />
        </div>
        <div class="info">
          <div class="info_main">
            <div class="info_head">
              <h2 th:if="${user.fullName}" th:text="${user.fullName}">
                Full Name
              </h2>
              <p th:if="${user.username}" th:text="${user.username}">
                @username
              </p>
            </div>
            <div class="top-btns">
              <a href="#" class="follow-btn" th:if="${!current}"> Follow </a>
              <a href="/profile/edit" class="setting-btn" th:if="${current}">
                Edit Profile
              </a>

              <a
                href="#"
                class="message-btn"
                th:classappend="${current ? 'disabled' : ''}"
                th:if="${current}"
              >
                Message
              </a>
              <a
                th:href="@{'/setting/' + ${currUsername}}"
                class="setting-btn"
                th:classappend="${current ? 'disabled' : ''}"
                th:if="${current}"
              >
                <i class="fa-solid fa-gear"></i>
              </a>

              <!-- <a href="#" class="follow-btn">Following</a>
              <a href="#" class="message-btn">Message</a>
              <a href="/profile/edit" class="setting-btn"
                ><i class="fa-solid fa-gear"></i
              ></a> -->
            </div>
          </div>
          <p th:if="${user.bio}" th:text="${user.bio}">User Bio</p>
        </div>
        <div class="footer">
          <div class="icons">
            <div class="icon-text" th:if="${user.url}">
              <i class="fa-solid fa-link"></i>
              <a th:href="${user.url}">
                <span th:text="${user.url}">URL</span>
              </a>
            </div>
            <div class="icon-text" th:if="${user.country}">
              <i class="fa-solid fa-location-dot"></i>
              <p th:text="${user.country}">Country</p>
            </div>
          </div>
        </div>
        <div class="stats">
          <div>
            <h3 th:text="${totalBlogs != null ? totalBlogs : '0'}">0</h3>
            <p>Blogs</p>
          </div>
          <div>
            <h3>238</h3>
            <p>Following</p>
          </div>
          <div>
            <h3>84</h3>
            <p>Followers</p>
          </div>
        </div>
      </div>
      <div class="articles">
        <article class="articles">
          <!-- Check if blogs list is empty -->

          <div th:if="${blogs.empty}" class="no-article">
            <img
              th:src="@{/icons/green-img.png}"
              src="/src/main/resources/static/icons/green-img.png"
              alt="default"
            />
            <div>
              <h3>Share Blogs</h3>
              <p>When you share blogs, they will appear on your profile.</p>
              <a href="/blogs/create" class="create-blog-btn-profile"
                >Share your first photo</a
              >
            </div>
          </div>

          <div th:each="blog : ${blogs}" class="article">
            <img
              th:if="${blog.imageBase64}"
              th:src="'data:image/jpeg;base64,' + ${blog.imageBase64}"
              alt="Blog Image"
            />
            <img
              th:unless="${blog.imageBase64}"
              th:src="@{/img/background.jpg}"
              alt="Blog Image"
            />
            <div class="article-content">
              <span class="source" th:text="${blog.authorId}"></span>
              <h3 class="title">
                <a th:href="@{'/blogs/' + ${blog.id}}" th:text="${blog.title}"
                  >Blog Title</a
                >
              </h3>
              <span class="date" th:text="${blog.dateString}"></span>

              <button class="toggle-actions">
                <i class="fa-solid fa-ellipsis-vertical"></i>
              </button>
              <div class="article-actions">
                <button title="Share">
                  <a th:href="@{'/blogs/' + ${blog.id}}"
                    ><i class="fa-solid fa-share"></i
                  ></a>
                </button>
                <button title="Delete">
                  <a th:href="@{'/blogs/delete/' + ${blog.id}}">
                    <i class="fa-solid fa-trash"></i>
                  </a>
                </button>
                <button title="Edit">
                  <a th:href="@{'/blogs/edit/' + ${blog.id}}">
                    <i class="fa-solid fa-edit"></i
                  ></a>
                </button>

                <button class="close-actions" style="display: none">
                  <i class="fa-solid fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        </article>
        <!-- Check if there is a success message -->
        <div
          class="message-card success"
          th:if="${message}"
          
        >
        <span th:text="${message}"></span>
          <button class="close-actions">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
        <div class="message-card error" th:if="${error}">
          <span th:text="${message}"></span>
          <button class="close-actions">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="container" th:if="${error}">
      <div class="header">
        <h2 style="color: rgb(172, 31, 31)" th:text="${error}">
          User Not Found!
        </h2>
      </div>
    </div>
    <div class="bottom-nav-container">
      <nav class="bottom-nav">
        <button class="nav-item">
          <a href="/home"><i class="fa-regular fa-paper-plane"></i></a>
        </button>
        <button class="nav-item">
          <a href="/blogs/create"
            ><i class="fa-solid fa-plus create-blog-btn"></i
          ></a>
        </button>
        <button class="nav-item">
          <a href="/blogs/saved"><i class="fa-regular fa-bookmark"></i></a>
        </button>
        <button class="nav-item" th:if="${user != null}">
          <a th:href="@{/profile/{username}(username=${currUsername})}"
            ><i class="fa-regular fa-user"></i
          ></a>
        </button>
        <button class="nav-item" th:unless="${user != null}">
          <a href="/auth/login"><i class="fa-regular fa-user"></i></a>
        </button>
      </nav>
    </div>
    <script>
      // JavaScript for article actions toggle
      document.addEventListener("DOMContentLoaded", function () {
        const closeButtons = document.querySelectorAll(".close-actions");

        closeButtons.forEach((button) => {
          button.addEventListener("click", () => {
            button.parentElement.style.display = "none";
          });
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const toggleActions = document.querySelectorAll(".toggle-actions");

        toggleActions.forEach((toggle) => {
          toggle.addEventListener("click", () => {
            const articleActions =
              toggle.parentElement.querySelector(".article-actions");
            const closeActionsBtn =
              articleActions.querySelector(".close-actions");

            if (articleActions.classList.contains("show")) {
              articleActions.classList.remove("show");
              closeActionsBtn.style.display = "none";
            } else {
              document
                .querySelectorAll(".article-actions")
                .forEach((actions) => {
                  actions.classList.remove("show");
                  actions.querySelector(".close-actions").style.display =
                    "none";
                });
              articleActions.classList.add("show");
              closeActionsBtn.style.display = "block";
            }
          });
        });

        document.addEventListener("click", function (event) {
          const articleActions = document.querySelectorAll(".article-actions");
          const toggleActions = document.querySelectorAll(".toggle-actions");

          if (
            !event.target.closest(".article-actions") &&
            !event.target.closest(".toggle-actions")
          ) {
            articleActions.forEach((actions) => {
              actions.classList.remove("show");
              actions.querySelector(".close-actions").style.display = "none";
            });
          }
        });

        document.querySelectorAll(".close-actions").forEach((closeBtn) => {
          closeBtn.addEventListener("click", (event) => {
            const articleActions = closeBtn.parentElement;
            articleActions.classList.remove("show");
            closeBtn.style.display = "none";
          });
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        var loadingOverlay = document.querySelector(".loading-overlay");
        /* Check if Thymeleaf variable 'loading' is true/false */
        var loading = /*[[${loading}]]*/ false;

        if (loading) {
          loadingOverlay.style.display = "flex"; /* Show loading overlay */
        } else {
          loadingOverlay.style.display = "none"; /* Hide loading overlay */
        }
      });

      function showLoadingSpinner() {
        document.querySelector(".edit-form").classList.add("loading");
        document.getElementById("loadingSpinner").style.display = "block";
      }

      function hideMessageCard(button) {
        button.parentElement.style.display = "none";
      }
    </script>
  </body>
</html>
